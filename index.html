<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>المُصرّف الذكي للأفعال الفارسية</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0d6efd; --success-color: #198754; --warning-color: #ffc107; --info-color: #0dcaf0;
            --light-bg: #f8f9fa; --white-bg: #ffffff; --dark-text: #212529; --border-color: #dee2e6;
            --background-color: #eef2f7;
        }
        *, *::before, *::after { box-sizing: border-box; }
        html { height: 100%; overflow: hidden; }
        body {
            display: flex; flex-direction: column; height: 100%; overflow: hidden; 
            margin: 0; font-family: 'Cairo', 'Tahoma', sans-serif; background-color: var(--background-color);
        }
        .persian-text { font-family: 'Vazirmatn', sans-serif; }
        .fixed-header, .fixed-footer {
            flex-shrink: 0; background-color: var(--white-bg); z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .fixed-header h1 { font-size: 24px; color: var(--primary-color); text-align: center; margin: 10px 0; }
        .fixed-footer p { text-align: center; margin: 15px 0; color: #6c757d; font-size: 14px; }
        #scroll-wrapper { flex-grow: 1; overflow-y: auto; padding: 20px 10px; }
        #main-container {
            background: var(--white-bg); padding: 25px 30px; border-radius: 18px; width: 100%;
            max-width: 900px; margin: 0 auto; position: relative; z-index: 1; overflow: hidden;
            border: 3px solid transparent;
        }
        #main-container::before {
            content: ''; position: absolute; top: -3px; left: -3px; width: calc(100% + 6px); height: calc(100% + 6px);
            background: linear-gradient(60deg, #0d6efd, #0dcaf0, #198754, #ffc107);
            background-size: 400% 400%; border-radius: 20px; z-index: -1;
            animation: gradient-animation 5s ease infinite;
        }
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; }
        }
        h2 { font-size: 20px; margin-top: 30px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color); }
        .input-section { margin-bottom: 25px; }
        #verb-select, #verb-input { width: 100%; padding: 14px; font-size: 18px; border-radius: 8px; border: 1px solid var(--border-color); }
        #verb-input { direction: ltr; }
        #conjugate-btn { width: 100%; padding: 15px; margin-top: 15px; font-size: 18px; font-weight: bold; color: #fff; background: linear-gradient(45deg, var(--success-color), #20c997); border: none; border-radius: 8px; cursor: pointer; }
        #results-container { margin-top: 30px; }
        #correction-notice, #verb-info { text-align: center; margin-bottom: 15px; padding: 14px; border-radius: 8px; display: none; }
        #correction-notice { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        #verb-info { background-color: #e0eaff; }
        .table-responsive { width: 100%; overflow-x: auto; }
        #conjugation-table { width: 100%; border-collapse: collapse; display: none; }
        #conjugation-table th, #conjugation-table td { border: 1px solid var(--border-color); padding: 12px; text-align: center; font-size: 16px; }
        #conjugation-table th { background-color: var(--primary-color); color: white; }
        #examples-section { margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); display: none; }
        #example-options { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        #example-options button { background: var(--warning-color); color: var(--dark-text); border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; }
        #sentences-container { margin-top: 20px; padding: 20px; background-color: var(--light-bg); border-radius: 8px; display: none; }
        #sentences-container ul { list-style-type: none; padding: 0; margin: 0; }
        #sentences-container li { font-size: 17px; padding: 10px; border-bottom: 1px solid #e9ecef; }
        .arabic-translation { color: #6c757d; font-size: 14px; margin-right: 10px;}
        @media (max-width: 768px) { #scroll-wrapper { padding: 10px 5px; } .fixed-header h1 { font-size: 20px; } #main-container { padding: 15px; } }
    </style>
</head>
<body>
    <header class="fixed-header"><h1>المُصرّف الذكي للأفعال الفارسية</h1></header>
    <div id="scroll-wrapper">
        <div id="main-container">
            <div id="controls-container">
                <h2 class="persian-text">۱. انتخاب از لیست</h2>
                <div class="input-section"><select id="verb-select" class="persian-text"></select></div>
                <h2 class="persian-text">۲. یا نوشتن هر فعل</h2>
                <div class="input-section">
                    <input type="text" id="verb-input" class="persian-text" placeholder="اكتب بالكيبورد الفارسي حصراً.">
                    <button id="conjugate-btn" class="persian-text"><span>صَرّف الفعل</span></button>
                </div>
            </div>
            <div id="results-container">
                <div id="correction-notice"></div>
                <div id="verb-info" class="persian-text"></div>
                <div class="table-responsive"><table id="conjugation-table"><thead><tr><th class="pronoun-col">الضمير</th><th class="persian-text">ماضی ساده</th><th class="persian-text">حال اخباری</th><th class="persian-text">امر</th></tr></thead><tbody id="table-body" class="persian-text"></tbody></table></div>
                <div id="examples-section">
                    <div id="example-options">
                        <button id="present-examples-btn" class="persian-text">جمله‌های مضارع</button>
                        <button id="past-examples-btn" class="persian-text">جمله‌های ماضی</button>
                    </div>
                    <div id="sentences-container"></div>
                </div>
            </div>
        </div>
    </div>
    <footer class="fixed-footer"><p>جميع الحقوق محفوظة. تم بواسطة احمد فلاح</p></footer>

    <script>
        // --- DATA ---
        const pronouns = [ { fa: "من", ar: "أنا" }, { fa: "تو", ar: "أنت" }, { fa: "او", ar: "هو/هي" }, { fa: "ما", ar: "نحن" }, { fa: "شما", ar: "أنتم" }, { fa: "آنها", ar: "هم" } ];
        const verbStems = {"آفریدن":"آفرین","آمدن":"آ","آوردن":"آور","انداختن":"انداز","ایستادن":"ایست","باز کردن":"باز کن","بازی کردن":"بازی کن","باور کردن":"باور کن","بخشیدن":"بخش","بردن":"بر","بستن":"بند","بلند کردن":"بلند کن","به یاد آوردن":"به یاد آور","بودن":"باش","پذیرفتن":"پذیر","پریدن":"پر","پرسیدن":"پرس","پیدا کردن":"پیدا کن","پوشیدن":"پوش","ترسیدن":"ترس","تنظیم کردن":"تنظیم کن","توانستن":"توان","توضیح دادن":"توضیح ده","جنگیدن":"جنگ","حرکت کردن":"حرکت کن","خواستن":"خواه","خواندن":"خوان","خریدن":"خر","خندیدن":"خند","خوابیدن":"خواب","خوردن":"خور","دادن":"ده","داشتن":"دار","دانستن":"دان","دنبال کردن":"دنبال کن","دویدن":"دو","دیدن":"بین","راه رفتن":"راه رو","رفتن":"رو","زنگ زدن":"زنگ زن","زندگی کردن":"زندگی کن","ساختن":"ساز","ستدن":"ستان","سخن گفتن":"سخن گو","سعی کردن":"سعی کن","سفر کردن":"سفر کن","شناختن":"شناس","شنیدن":"شنو","شدن":"شو","شروع کردن":"شروع کن","شکستن":"شکن","صحبت کردن":"صحبت کن","فروختن":"فروش","فکر کردن":"فکر کن","فهمیدن":"فهم","کار کردن":"کار کن","کشتن":"کش","کمک کردن":"کمک کن","کنار زدن":"کنار زن","گذاشتن":"گذار","گرفتن":"گیر","گفتن":"گو","گم شدن":"گم شو","گم کردن":"گم کن","گوش دادن":"گوش ده","مردن":"میر","نشستن":"نشین","نگاه کردن":"نگاه کن","نوشتن":"نویس","یاد دادن":"یاد ده","یاد گرفتن":"یاد گیر","انتخاب کردن":"انتخاب کن","احساس کردن":"احساس کن","استفاده کردن":"استفاده کن"};
        const verbMeanings = {"آفریدن":"الخلق","آمدن":"المجيء","آوردن":"الإحضار","انداختن":"الرمي","ایستادن":"الوقوف","باز کردن":"الفتح","بازی کردن":"اللعب","باور کردن":"التصديق","بخشیدن":"المسامحة","بردن":"الأخذ","بستن":"الإغلاق","بلند کردن":"الرفع","به یاد آوردن":"التذكر","بودن":"الكينونة","پذیرفتن":"القبول","پریدن":"القفز","پرسیدن":"السؤال","پیدا کردن":"الإيجاد","پوشیدن":"اللبس","ترسیدن":"الخوف","تنظیم کردن":"التنظيم","توانستن":"الاستطاعة","توضیح دادن":"الشرح","جنگیدن":"القتال","حرکت کردن":"التحرك","خواستن":"الإرادة/الطلب","خواندن":"القراءة","خریدن":"الشراء","خندیدن":"الضحك","خوابیدن":"النوم","خوردن":"الأكل","دادن":"الإعطاء","داشتن":"الملكية","دانستن":"المعرفة","دنبال کردن":"المتابعة","دویدن":"الركض","دیدن":"الرؤية","راه رفتن":"المشي","رفتن":"الذهاب","زنگ زدن":"الاتصال","زندگی کردن":"العيش","ساختن":"الصنع","ستدن":"الأخذ (قديم)","سخن گفتن":"التحدث","سعی کردن":"المحاولة","سفر کردن":"السفر","شناختن":"التعرف","شنیدن":"السماع","شدن":"الصيورة","شروع کردن":"البدء","شکستن":"الكسر","صحبت کردن":"التكلم","فروختن":"البيع","فکر کردن":"التفكير","فهمیدن":"الفهم","کار کردن":"العمل","کشتن":"القتل","کمک کردن":"المساعدة","کنار زدن":"الإزاحة","گذاشتن":"الوضع","گرفتن":"الأخذ","گفتن":"القول","گم شدن":"الضياع","گم کردن":"الإضاعة","گوش دادن":"الاستماع","مردن":"الموت","نشستن":"الجلوس","نگاه کردن":"النظر","نوشتن":"الكتابة","یاد دادن":"التعليم","یاد گرفتن":"التعلم","انتخاب کردن":"الاختيار","احساس کردن":"الإحساس","استفاده کردن":"الاستخدام"};
        const sentenceTemplates = { "آفریدن": { phrase: "جهان را", ar_phrase: "العالم", ar_verb: { past: ["خلقتُ","خلقتَ","خلق","خلقنا","خلقتم","خلقوا"], present: ["أخلقُ","تخلقُ","يخلقُ","نخلقُ","تخلقون","يخلقون"] } }, "آمدن": { phrase: "به خانه", ar_phrase: "إلى البيت", ar_verb: { past: ["أتيتُ","أتيتَ","أتى","أتينا","أتيتم","أتوا"], present: ["آتي","تأتي","يأتي","نأتي","تأتون","يأتون"] } }, "آوردن": { phrase: "یک هدیه را", ar_phrase: "هدية", ar_verb: { past: ["أحضرتُ","أحضرتَ","أحضر","أحضرنا","أحضرتم","أحضروا"], present: ["أُحضرُ","تُحضرُ","يُحضرُ","نُحضرُ","تُحضرون","يُحضرون"] } }, "انداختن": { phrase: "توپ را در سبد", ar_phrase: "الكرة في السلة", ar_verb: { past: ["رميتُ","رميتَ","رمى","رمينا","رميتم","رموا"], present: ["أرمي","ترمي","يرمي","نرمي","ترمُون","يرمون"] } }, "احساس کردن": { phrase: "خستگی", ar_phrase: "التعب", ar_verb: { past: ["أحسستُ","أحسستَ","أحس","أحسسنا","أحسستم","أحسوا"], present: ["أحسُ","تحسُ","يحسُ","نحسُ","تحسون","يحسون"] } }, "استفاده کردن": { phrase: "از فرصت", ar_phrase: "من الفرصة", ar_verb: { past: ["استخدمتُ","استخدمتَ","استخدم","استخدمنا","استخدمتم","استخدموا"], present: ["أستخدمُ","تستخدمُ","يستخدمُ","نستخدمُ","تستخدمون","يستخدمون"] } }, "انتخاب کردن": { phrase: "بهترین گزینه را", ar_phrase: "الخيار الأفضل", ar_verb: { past: ["اخترتُ","اخترتَ","اختار","اخترنا","اخترتم","اختاروا"], present: ["أختارُ","تختارُ","يختارُ","نختارُ","تختارون","يختارون"] } }, "ایستادن": { phrase: "در صف", ar_phrase: "في الطابور", ar_verb: { past: ["وقفتُ","وقفتَ","وقف","وقفنا","وقفتم","وقفوا"], present: ["أقفُ","تقفُ","يقفُ","نقفُ","تقفون","يقفون"] } }, "باز کردن": { phrase: "در را", ar_phrase: "الباب", ar_verb: { past: ["فتحتُ","فتحتَ","فتح","فتحنا","فتحتم","فتحوا"], present: ["أفتحُ","تفتحُ","يفتحُ","نفتحُ","تفتحون","يفتحون"] } }, "بازی کردن": { phrase: "فوتبال", ar_phrase: "كرة القدم", ar_verb: { past: ["لعبتُ","لعبتَ","لعب","لعبنا","لعبتم","لعبوا"], present: ["ألعبُ","تلعبُ","يلعبُ","نلعبُ","تلعبون","يلعبون"] } }, "باور کردن": { phrase: "حرف او را", ar_phrase: "كلامه", ar_verb: { past: ["صدقتُ","صدقتَ","صدق","صدقنا","صدقتم","صدقوا"], present: ["أصدقُ","تصدقُ","يصدقُ","نصدقُ","تصدقون","يصدقون"] } }, "بخشیدن": { phrase: "خطای او را", ar_phrase: "خطأه", ar_verb: { past: ["سامحتُ","سامحتَ","سامح","سامحنا","سامحتم","سامحوا"], present: ["أسامحُ","تسامحُ","يسامحُ","نسامحُ","تسامحون","يسامحون"] } }, "بردن": { phrase: "کتاب را", ar_phrase: "الكتاب", ar_verb: { past: ["أخذتُ","أخذتَ","أخذ","أخذنا","أخذتم","أخذوا"], present: ["آخذُ","تأخذُ","يأخذُ","نأخذُ","تأخذون","يأخذون"] } }, "بستن": { phrase: "پنجره را", ar_phrase: "النافذة", ar_verb: { past: ["أغلقتُ","أغلقتَ","أغلق","أغلقنا","أغلقتم","أغلقوا"], present: ["أُغلقُ","تُغلقُ","يُغلقُ","نُغلقُ","تُغلقون","يُغلقون"] } }, "بلند کردن": { phrase: "جعبه را", ar_phrase: "الصندوق", ar_verb: { past: ["رفعتُ","رفعتَ","رفع","رفعنا","رفعتم","رفعوا"], present: ["أرفعُ","ترفعُ","يرفعُ","نرفعُ","ترفعون","يرفعون"] } }, "به یاد آوردن": { phrase: "خاطرات را", ar_phrase: "الذكريات", ar_verb: { past: ["تذكرتُ","تذكرتَ","تذكر","تذكرنا","تذكرتم","تذكروا"], present: ["أتذكرُ","تتذكرُ","يتذكرُ","نتذكرُ","تتذكرون","يتذكرون"] } }, "بودن": { phrase: "در کلاس", ar_phrase: "في الصف", ar_verb: { past: ["كنتُ","كنتَ","كان","كنا","كنتم","كانوا"], present: ["أكونُ","تكونُ","يكونُ","نكونُ","تكونون","يكونون"] } }, "پذیرفتن": { phrase: "دعوت را", ar_phrase: "الدعوة", ar_verb: { past: ["قبلتُ","قبلتَ","قبل","قبلنا","قبلتم","قبلوا"], present: ["أقبلُ","تقبلُ","يقبلُ","نقبلُ","تقبلون","يقبلون"] } }, "پریدن": { phrase: "از روی مانع", ar_phrase: "من فوق الحاجز", ar_verb: { past: ["قفزتُ","قفزتَ","قفز","قفزنا","قفزتم","قفزوا"], present: ["أقفزُ","تقفزُ","يقفزُ","نقفزُ","تقفزون","يقفزون"] } }, "پرسیدن": { phrase: "یک سوال را", ar_phrase: "سؤالاً", ar_verb: { past: ["سألتُ","سألتَ","سأل","سألنا","سألتم","سألوا"], present: ["أسألُ","تسألُ","يسألُ","نسألُ","تسألون","يسألون"] } }, "پیدا کردن": { phrase: "کلیدهایش را", ar_phrase: "مفاتيحه", ar_verb: { past: ["وجدتُ","وجدتَ","وجد","وجدنا","وجدتم","وجدوا"], present: ["أجدُ","تجدُ","يجدُ","نجدُ","تجدون","يجدون"] } }, "پوشیدن": { phrase: "لباس جدید را", ar_phrase: "الثوب الجديد", ar_verb: { past: ["لبستُ","لبستَ","لبس","لبسنا","لبستم","لبسوا"], present: ["ألبسُ","تلبسُ","يلبسُ","نلبسُ","تلبسون","يلبسون"] } }, "ترسیدن": { phrase: "از تاریکی", ar_phrase: "من الظلام", ar_verb: { past: ["خفتُ","خفتَ","خاف","خفنا","خفتم","خافوا"], present: ["أخافُ","تخافُ","يخافُ","نخافُ","تخافون","يخافون"] } }, "تنظیم کردن": { phrase: "ساعت را", ar_phrase: "الساعة", ar_verb: { past: ["نظمتُ","نظمتَ","نظم","نظمنا","نظمتم","نظموا"], present: ["أنظمُ","تنظمُ","ينظمُ","ننظمُ","تنظمون","ينظمون"] } }, "توانستن": { phrase: "این کار را انجام دهد", ar_phrase: "أن يفعل هذا الأمر", ar_verb: { past: ["استطعتُ","استطعتَ","استطاع","استطعنا","استطعتم","استطاعوا"], present: ["أستطيعُ","تستطيعُ","يستطيعُ","نستطيعُ","تستطيعون","يستطيعون"] } }, "توضیح دادن": { phrase: "درس را", ar_phrase: "الدرس", ar_verb: { past: ["شرحتُ","شرحتَ","شرح","شرحنا","شرحتم","شرحوا"], present: ["أشرحُ","تشرحُ","يشرحُ","نشرحُ","تشرحون","يشرحون"] } }, "جنگیدن": { phrase: "برای آزادی", ar_phrase: "من أجل الحرية", ar_verb: { past: ["قاتلتُ","قاتلتَ","قاتل","قاتلنا","قاتلتم","قاتلوا"], present: ["أقاتلُ","تقاتلُ","يقاتلُ","نقاتلُ","تقاتلون","يقاتلون"] } }, "حرکت کردن": { phrase: "به سمت جلو", ar_phrase: "نحو الأمام", ar_verb: { past: ["تحركتُ","تحركتَ","تحرك","تحركنا","تحركتم","تحركوا"], present: ["أتحركُ","تتحركُ","يتحركُ","نتحركُ","تتحركون","يتحركون"] } }, "خواستن": { phrase: "یک لیوان آب", ar_phrase: "كوب ماء", ar_verb: { past: ["أردتُ","أردتَ","أراد","أردنا","أردتم","أرادوا"], present: ["أريدُ","تريدُ","يريدُ","نريدُ","تريدون","يريدون"] } }, "خواندن": { phrase: "کتاب را", ar_phrase: "الكتاب", ar_verb: { past: ["قرأتُ","قرأتَ","قرأ","قرأنا","قرأتم","قرأوا"], present: ["أقرأُ","تقرأُ","يقرأُ","نقرأُ","تقرأون","يقرأون"] } }, "خریدن": { phrase: "میوه", ar_phrase: "فاكهة", ar_verb: { past: ["اشتريتُ","اشتريتَ","اشترى","اشترينا","اشتريتم","اشتروا"], present: ["أشتري","تشتري","يشتري","نشتري","تشترون","يشترون"] } }, "خندیدن": { phrase: "با صدای بلند", ar_phrase: "بصوت عالٍ", ar_verb: { past: ["ضحكتُ","ضحكتَ","ضحك","ضحكنا","ضحكتم","ضحكوا"], present: ["أضحكُ","تضحكُ","يضحكُ","نضحكُ","تضحكون","يضحكون"] } }, "خوابیدن": { phrase: "زود", ar_phrase: "مبكراً", ar_verb: { past: ["نمتُ","نمتَ","نام","نمنا","نمتم","ناموا"], present: ["أنامُ","تنامُ","ينامُ","ننامُ","تنامون","ينامون"] } }, "خوردن": { phrase: "شام را", ar_phrase: "العشاء", ar_verb: { past: ["أكلتُ","أكلتَ","أكل","أكلنا","أكلتم","أكلوا"], present: ["آكلُ","تأكلُ","يأكلُ","نأكلُ","تأكلون","يأكلون"] } }, "دادن": { phrase: "گل به مادر", ar_phrase: "وردة للأم", ar_verb: { past: ["أعطيتُ", "أعطيتَ", "أعطى", "أعطينا", "أعطيتم", "أعطوا"], present: ["أعطي", "تعطي", "يعطي", "نعطي", "تعطون", "يعطون"] } }, "داشتن": { phrase: "یک ماشین خوب", ar_phrase: "سيارة جيدة", ar_verb: { past: ["كان لديّ", "كان لديكَ", "كان لديه", "كان لدينا", "كان لديكم", "كان لديهم"], present: ["لديّ", "لديكَ", "لديه", "لدينا", "لديكم", "لديهم"] } }, "دانستن": { phrase: "جواب را", ar_phrase: "الإجابة", ar_verb: { past: ["عرفتُ","رفتَ","رف","رفنا","رفتم","رفوا"], present: ["أعرفُ","تعرفُ","يعرفُ","نعرفُ","تعرفون","يعرفون"] } }, "دنبال کردن": { phrase: "اهداف خود را", ar_phrase: "أهدافه", ar_verb: { past: ["تابعتُ","تابعتَ","تابع","تابعنا","تابعتم","تابعوا"], present: ["أتابعُ","تتابعُ","يتابعُ","نتابعُ","تتابعون","يتابعون"] } }, "دویدن": { phrase: "در پارک", ar_phrase: "في الحديقة", ar_verb: { past: ["ركضتُ","ركضتَ","ركض","ركضنا","ركضتم","ركضوا"], present: ["أركضُ","تركضُ","يركضُ","نركضُ","تركضون","يركضون"] } }, "دیدن": { phrase: "یک دوست قدیمی را", ar_phrase: "صديقاً قديماً", ar_verb: { past: ["رأيتُ","رأيتَ","رأى","رأينا","رأيتم","رأوا"], present: ["أرى","ترى","يرى","نرى","ترون","يرون"] } }, "راه رفتن": { phrase: "در خیابان", ar_phrase: "في الشارع", ar_verb: { past: ["مشيتُ","مشيتَ","مشى","مشينا","مشيتم","مشوا"], present: ["أمشي","تمشي","يمشي","نمشي","تمشون","يمشون"] } }, "زنگ زدن": { phrase: "به دوستش", ar_phrase: "بصديقه", ar_verb: { past: ["اتصلتُ","اتصلتَ","اتصل","اتصلنا","اتصلتم","اتصلوا"], present: ["أتصلُ","تتصلُ","يتصلُ","نتصلُ","تتصلون","يتصلون"] } }, "زندگی کردن": { phrase: "در آرامش", ar_phrase: "في سلام", ar_verb: { past: ["عشتُ","عشتَ","عاش","عشنا","عشتم","عاشوا"], present: ["أعيشُ","تعيشُ","يعيشُ","نعيشُ","تعيشون","يعيشون"] } }, "ساختن": { phrase: "یک مدل هواپیما", ar_phrase: "نموذج طائرة", ar_verb: { past: ["صنعتُ","صنعتَ","صنع","صنعنا","صنعتم","صنعوا"], present: ["أصنعُ","تصنعُ","يصنعُ","نصنعُ","تصنعون","يصنعون"] } }, "سعی کردن": { phrase: "برای موفقیت", ar_phrase: "للنجاح", ar_verb: { past: ["حاولتُ","حاولتَ","حاول","حاولنا","حاولتم","حاولوا"], present: ["أحاولُ","تحاولُ","يحاولُ","نحاولُ","تحاولون","يحاولون"] } }, "سفر کردن": { phrase: "به شمال", ar_phrase: "إلى الشمال", ar_verb: { past: ["سافرتُ","سافرتَ","سافر","سافرنا","سافرتم","سافروا"], present: ["أسافرُ","تسافرُ","يسافرُ","نسافرُ","تسافرون","يسافرون"] } }, "شناختن": { phrase: "یک دوست خوب را", ar_phrase: "صديقاً جيداً", ar_verb: { past: ["عرفتُ","عرفتَ","عرف","عرفنا","عرفتم","عرفوا"], present: ["أعرفُ","تعرفُ","يعرفُ","نعرفُ","تعرفون","يعرفون"] } }, "شنیدن": { phrase: "یک خبر خوب", ar_phrase: "خبراً جيداً", ar_verb: { past: ["سمعتُ","سمعتَ","سمع","سمعنا","سمعتم","سمعوا"], present: ["أسمعُ","تسمعُ","يسمعُ","نسمعُ","تسمعون","يسمعون"] } }, "شدن": { phrase: "پزشک", ar_phrase: "طبيباً", ar_verb: { past: ["أصبحتُ","أصبحتَ","أصبح","أصبحنا","أصبحتم","أصبحوا"], present: ["أُصبحُ","تُصبحُ","يُصبحُ","نُصبحُ","تُصبحون","يُصبحون"] } }, "شروع کردن": { phrase: "پروژه را", ar_phrase: "المشروع", ar_verb: { past: ["بدأتُ","بدأتَ","بدأ","بدأنا","بدأتم","بدأوا"], present: ["أبدأُ","تبدأُ","يبدأُ","نبدأُ","تبدأون","يبدأون"] } }, "شکستن": { phrase: "یک رکورد را", ar_phrase: "رقماً قياسياً", ar_verb: { past: ["كسرتُ","كسرتَ","كسر","كسرنا","كسرتم","كسروا"], present: ["أكسرُ","تكسرُ","يكسرُ","نكسرُ","تكسرون","يكسرون"] } }, "فروختن": { phrase: "خانه خود را", ar_phrase: "بيته", ar_verb: { past: ["بعتُ","بعتَ","باع","بعنا","بعتم","باعوا"], present: ["أبيعُ","تبيعُ","يبيعُ","نبيعُ","تبيعون","يبيعون"] } }, "فکر کردن": { phrase: "به یک راه حل", ar_phrase: "في حل", ar_verb: { past: ["فكرتُ", "فكرتَ", "فكر", "فكرنا", "فكرتم", "فكروا"], present: ["أفكرُ", "تفكرُ", "يفكرُ", "نفكرُ", "تفكرون", "يفكرون"] } }, "فهمیدن": { phrase: "موضوع را", ar_phrase: "الموضوع", ar_verb: { past: ["فهمتُ","فهمتَ","فهم","فهمنا","فهمتم","فهموا"], present: ["أفهمُ","تفهمُ","يفهمُ","نفهمُ","تفهمون","يفهمون"] } }, "کار کردن": { phrase: "با کامپیوتر", ar_phrase: "بالحاسوب", ar_verb: { past: ["عملتُ", "عملتَ", "عمل", "عملنا", "عملتم", "عملوا"], present: ["أعملُ", "تعملُ", "يعملُ", "نعملُ", "تعملون", "يعملون"] } }, "کمک کردن": { phrase: "به یک سالمند", ar_phrase: "مسناً", ar_verb: { past: ["ساعدتُ","ساعدتَ","ساعد","ساعدنا","ساعدتم","ساعدوا"], present: ["أساعدُ","تساعدُ","يساعدُ","نساعدُ","تساعدون","يساعدون"] } }, "گذاشتن": { phrase: "کلید را روی میز", ar_phrase: "المفتاح على الطاولة", ar_verb: { past: ["وضعتُ", "وضعتَ", "وضع", "وضعنا", "وضعتم", "وضعوا"], present: ["أضعُ", "تضعُ", "يضعُ", "نضعُ", "تضعون", "يضعون"] } }, "گرفتن": { phrase: "یک تاکسی", ar_phrase: "سيارة أجرة", ar_verb: { past: ["أخذتُ", "أخذتَ", "أخذ", "أخذنا", "أخذتم", "أخذوا"], present: ["آخذُ", "تأخذُ", "يأخذُ", "نأخذُ", "تأخذون", "يأخذون"] } }, "گفتن": { phrase: "حقیقت را", ar_phrase: "الحقيقة", ar_verb: { past: ["قلتُ","قلتَ","قال","قلنا","قلتم","قالوا"], present: ["أقولُ","تقولُ","يقولُ","نقولُ","تقولون","يقولون"] } }, "گم کردن": { phrase: "کیف پول را", ar_phrase: "المحفظة", ar_verb: { past: ["أضعتُ", "أضعتَ", "أضاع", "أضعنا", "أضعتم", "أضاعوا"], present: ["أُضيعُ", "تُضيعُ", "يُضيعُ", "نُضيعُ", "تُضيعون", "يُضيعون"] } }, "گوش دادن": { phrase: "به موسیقی", ar_phrase: "للموسيقى", ar_verb: { past: ["استمعتُ", "استمعتَ", "استمع", "استمعنا", "استمعتم", "استمعوا"], present: ["أستمعُ", "تستمعُ", "يستمعُ", "نستمعُ", "تستمعون", "يستمعون"] } }, "نشستن": { phrase: "روی مبل", ar_phrase: "على الأريكة", ar_verb: { past: ["جلستُ", "جلستَ", "جلس", "جلسنا", "جلستم", "جلسوا"], present: ["أجلسُ", "تجلسُ", "يجلسُ", "نجلسُ", "تجلسون", "يجلسون"] } }, "نگاه کردن": { phrase: "به عکس‌ها", ar_phrase: "إلى الصور", ar_verb: { past: ["نظرتُ", "نظرتَ", "نظر", "نظرنا", "نظرتم", "نظروا"], present: ["أنظرُ", "تنظرُ", "ينظرُ", "ننظرُ", "تنظرون", "ينظرون"] } }, "یاد گرفتن": { phrase: "یک مهارت جدید", ar_phrase: "مهارة جديدة", ar_verb: { past: ["تعلمتُ", "تعلمتَ", "تعلم", "تعلمنا", "تعلمتم", "تعلموا"], present: ["أتعلمُ", "تتعلمُ", "يتعلمُ", "نتعلمُ", "تتعلمون", "يتعلمون"] } }, "یاد دادن": { phrase: "شنا به کودکان", ar_phrase: "السباحة للأطفال", ar_verb: { past: ["علمتُ", "علمتَ", "علم", "علمنا", "علمتم", "علموا"], present: ["أُعلمُ", "تُعلمُ", "يُعلمُ", "نُعلمُ", "تُعلمون", "يُعلمون"] } },
            "default": { phrase: "کاری را", ar_phrase: "عملاً ما", ar_verb: null }
        };

        // --- LOGIC ---
        let lastConjugationData = {};
        const elements = {};
        for (const elId of ['verb-select', 'verb-input', 'conjugate-btn', 'conjugation-table', 'table-body', 'verb-info', 'examples-section', 'present-examples-btn', 'past-examples-btn', 'sentences-container', 'correction-notice']) { elements[elId.replace(/-(\w)/g, (_, p1) => p1.toUpperCase())] = document.getElementById(elId); }
        
        function levenshtein(a,b){if(a.length==0)return b.length;if(b.length==0)return a.length;const m=Array(b.length+1).fill(null).map(()=>Array(a.length+1).fill(null));for(let i=0;i<=a.length;i++){m[0][i]=i}for(let j=0;j<=b.length;j++){m[j][0]=j}for(let j=1;j<=b.length;j++){for(let i=1;i<=a.length;i++){const c=a[i-1]===b[j-1]?0:1;m[j][i]=Math.min(m[j][i-1]+1,m[j-1][i]+1,m[j-1][i-1]+c)}}return m[b.length][a.length]}
        function autoCorrect(verb){const allKnownVerbs=[...Object.keys(verbStems)];if(allKnownVerbs.includes(verb))return{correctedVerb:verb,wasCorrected:false};let bestMatch=null,minDistance=2;for(const knownVerb of allKnownVerbs){const distance=levenshtein(verb,knownVerb);if(distance<minDistance){minDistance=distance;bestMatch=knownVerb}}return{correctedVerb:bestMatch||verb,wasCorrected:!!bestMatch}}
        function normalizeChars(text){return text.replace(/ي/g,'ی').replace(/ك/g,'ک')}
        
        // ---- بداية الكود الجديد ----

        function deriveStems(verbPart) {
            // محرك الاشتقاق الذكي الجديد
            // يحاول اشتقاق الجذور للأفعال غير الموجودة في قاعدة البيانات الأساسية
            // يعتمد على الأنماط الشائعة في اللغة الفارسية. لن يكون مثالياً 100% بسبب الأفعال الشاذة.
            if (!verbPart || !verbPart.endsWith('ن')) return null;
            
            const pastStem = verbPart.slice(0, -1);
            let presentStem = null;

            // الأولوية للقواعد الأكثر تحديداً ثم الأعم
            if (verbPart.endsWith('اختن')) {         // مثل: ساختن، شناختن
                presentStem = pastStem.slice(0, -2) + 'از'; // ساخت -> ساز
            } else if (verbPart.endsWith('اشتن')) {    // مثل: داشتن، پنداشتن
                presentStem = pastStem.slice(0, -2) + 'ار'; // داشت -> دار
            } else if (verbPart.endsWith('افتن')) {    // مثل: یافتن، شکافتن
                presentStem = pastStem.slice(0, -2) + 'اب'; // یافت -> یاب
            } else if (verbPart.endsWith('ودن')) {     // مثل: پیمودن، افزودن (Exceptions: بودن, شنودن)
                presentStem = pastStem.slice(0, -2) + 'ای'; // پیمود -> پیمای
            } else if (verbPart.endsWith('ادن')) {      // مثل: ایستادن، فرستادن (Exception: دادن)
                presentStem = pastStem.slice(0, -1); // ایستاد -> ایست
            } else if (verbPart.endsWith('ستن')) {      // مثل: دانستن، توانستن (Exception: شستن -> شو)
                 if (verbPart === 'شستن') { presentStem = 'شو'; }
                 else { presentStem = pastStem.slice(0, -1); } // دانست -> دان
            } else if (verbPart.endsWith('اندن')) {    // مثل: خواندن، راندن
                presentStem = pastStem.slice(0, -2) + 'ان'; // خواند -> خوان
            } else if (verbPart.endsWith('ردن')) {     // قاعدة خاصة لتصريف "کردن" في الأفعال المركبة
                 if (pastStem.endsWith('کرد')) { presentStem = pastStem.slice(0,-2) + 'ن'; } // کرد -> کن
            } else if (verbPart.endsWith('فتن')) {    // مثل: رفتن، گرفتن (قواعدها شاذة)
                if (verbPart === 'رفتن') { presentStem = 'رو'; }
                else if (verbPart === 'گرفتن') { presentStem = 'گیر'; }
            } else if (verbPart.endsWith('یدن')) {     // القاعدة العامة للأفعال المنتهية بـ یدن
                presentStem = pastStem.slice(0, -2); // ترسیدن -> ترس
            }
            
            if (presentStem) {
                return { pastStem, presentStem };
            }

            return null; // لا يمكن الاشتقاق
        }

        function conjugate(infinitive) {
            const finalInfinitive = infinitive.trim();
            if (!finalInfinitive) return;
            lastConjugationData.infinitive = finalInfinitive;
            const isCompound = finalInfinitive.includes(' ');
            let nounPart = '', verbPart = finalInfinitive, pastStem, presentStem;

            if (isCompound) {
                const parts = finalInfinitive.split(' ');
                nounPart = parts.slice(0, -1).join(' ') + ' ';
                verbPart = parts[parts.length - 1];
            }

            // ---- بداية المنطق الجديد والمحسن ----
            let stemsFound = false;

            // 1. نبحث أولاً في قاعدة البيانات الأساسية (verbStems) لأنها الأكثر دقة للأفعال الشاذة
            if (verbStems[finalInfinitive]) {
                pastStem = verbPart.slice(0, -1);
                // بالنسبة للأفعال المركبة، يكون الجذر في قاعدة البيانات كاملاً (مثل: "کار کن")
                // لذا، يجب أن نزيل الجزء الاسمي للحصول على جذر الفعل فقط ("کن")
                presentStem = verbStems[finalInfinitive].replace(nounPart, '');
                stemsFound = true;
            } else {
                // 2. إذا لم يكن الفعل في قاعدة البيانات، نستخدم محرك الاشتقاق الذكي لمحاولة إيجاد الجذور
                const derived = deriveStems(verbPart);
                if (derived) {
                    pastStem = derived.pastStem;
                    presentStem = derived.presentStem;
                    stemsFound = true;
                }
            }

            // 3. إذا فشلت كلتا الطريقتين، نبلغ المستخدم
            if (!stemsFound) {
                alert(`الفعل "${finalInfinitive}" شاذ أو غير معروف. لم نتمكن من تصريفه تلقائياً.`);
                return false;
            }
            // ---- نهاية المنطق الجديد والمحسن ----

            const fullPastStem = nounPart + pastStem, fullPresentStem = nounPart + presentStem;
            elements.verbInfo.innerHTML = `<span class="persian-text">المصدر: ${finalInfinitive}</span> | <span class="persian-text">الجذر الماضي: ${fullPastStem}</span> | <span class="persian-text">الجذر المضارع: ${fullPresentStem}</span>`;
            elements.verbInfo.style.display = 'block';
            const pastEndings = ['م', 'ی', '', 'یم', 'ید', 'ند'], presentEndings = ['م', 'ی', 'د', 'یم', 'ید', 'ند'];
            lastConjugationData.past = pastEndings.map(e => nounPart + pastStem + e);
            lastConjugationData.present = presentEndings.map(e => (nounPart ? nounPart + 'می‌' : 'می‌') + presentStem + e);
            lastConjugationData.imperative = generateImperative(verbPart, presentStem, nounPart, isCompound);
            displayTable(lastConjugationData);
            return true;
        }

        // ---- نهاية الكود الجديد ----

        function generateImperative(verbPart, presentStem, nounPart, isCompound) {
            let s, p;
            if (verbPart === 'داشتن') { s = 'داشته باش'; p = 'داشته باشید'; }
            else if (verbPart === 'بودن') { s = 'باش'; p = 'باشید'; }
            else if (verbPart === 'آمدن') { s = 'بیا'; p = 'بیایید'; }
            else {
                s = (isCompound || presentStem.startsWith('آ')) ? presentStem : `ب${presentStem}`;
                p = (isCompound || presentStem.startsWith('آ')) ? presentStem + 'ید' : `ب${presentStem}ید`;
            }
            return ['', nounPart + s, '', '', nounPart + p, ''];
        }
        function displayTable(data) {
            elements.tableBody.innerHTML = '';
            pronouns.forEach((p, i) => {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="pronoun-col">${p.fa}<br><small>(${p.ar})</small></td><td>${data.past[i]}</td><td>${data.present[i]}</td><td>${data.imperative[i] || '—'}</td>`;
                elements.tableBody.appendChild(row);
            });
            elements.conjugationTable.style.display = 'table';
            elements.examplesSection.style.display = 'block';
            elements.sentencesContainer.style.display = 'none';
        }
        
        function generateSentences(tense) {
            const template = sentenceTemplates[lastConjugationData.infinitive] || sentenceTemplates.default;
            const verbs = lastConjugationData[tense];
            let sentencesHTML = '<ul>';
            pronouns.forEach((p, i) => {
                const persianSentence = `${p.fa} ${template.phrase} ${verbs[i]}`;
                let arabicTranslation;
                if (template.ar_verb && template.ar_verb[tense]) {
                    const arabicVerb = template.ar_verb[tense][i];
                    arabicTranslation = `${p.ar} ${arabicVerb} ${template.ar_phrase}`;
                } else { arabicTranslation = `${p.ar} ... ${template.ar_phrase || ''}`; }
                sentencesHTML += `<li><span class="persian-text">${persianSentence.trim()}.</span> <span class="arabic-translation">(${arabicTranslation.trim()})</span></li>`;
            });
            sentencesHTML += '</ul>';
            elements.sentencesContainer.innerHTML = sentencesHTML;
            elements.sentencesContainer.style.display = 'block';
        }

        function handleRequest(source) {
            let verb = normalizeChars(source.value.trim());
            if (!verb) return;
            
            // التصحيح التلقائي
            const { correctedVerb, wasCorrected } = autoCorrect(verb);
            
            if (wasCorrected) {
                elements.correctionNotice.innerHTML = `هل تقصد <strong class="persian-text">"${correctedVerb}"</strong>؟ تم التصحيح تلقائيًا.`;
                elements.correctionNotice.style.display = 'block';
                verb = correctedVerb;
                source.value = verb; // تحديث الحقل بالفعل المصحح
            } else {
                elements.correctionNotice.style.display = 'none';
            }

            if (source.id === 'verb-input') { elements.verbSelect.value = ''; } else { elements.verbInput.value = ''; }
            if (conjugate(verb)) {
                // تم التصريف بنجاح
            }
        }

        // --- INIT & EVENT LISTENERS ---
        let allVerbs = Object.keys(verbStems).sort((a, b) => a.localeCompare(b, 'fa'));
        let optionsHtml = '<option value="">-- اختر فعلاً من القائمة --</option>';
        allVerbs.forEach(verb => { const meaning = verbMeanings[verb] || ''; optionsHtml += `<option value="${verb}">${verb} (${meaning})</option>`; });
        elements.verbSelect.innerHTML = optionsHtml;
        
        elements.verbSelect.addEventListener('change', () => handleRequest(elements.verbSelect));
        elements.conjugateBtn.addEventListener('click', () => handleRequest(elements.verbInput));
        elements.verbInput.addEventListener('keypress', (e) => { if (e.key === "Enter") { e.preventDefault(); handleRequest(elements.verbInput); } });
        elements.pastExamplesBtn.addEventListener('click', () => generateSentences('past'));
        elements.presentExamplesBtn.addEventListener('click', () => generateSentences('present'));
    </script>
</body>
</html>
